var dt_antrian,nomor_dipanggil,nomor_dipanggil_tanpa_kode,id_dipanggil;function panggil(a,e){nomor_dipanggil_tanpa_kode=e,e=berurut?kode+e:e,$.ajax({type:"post",url:base_url+"antrian/panggil",data:{no:e,layanan:nama_layanan},dataType:"json",beforeSend:function(){$(".loader2").show()},success:function(n){1==n.success?(nomor_dipanggil=e,id_dipanggil=a,cek_panggilan(n.id)):($(".loader2").hide(),alert("gagal memanggil, silahkan coba lagi"))},error:function(a){console.log(a.responseText),$(".loader2").hide(),alert("gagal memanggil, silahkan coba lagi")}})}function panggil_lagi(){panggil(id_dipanggil,nomor_dipanggil_tanpa_kode)}function cek_panggilan(a){let e=!1;$.ajax({type:"post",url:base_url+"antrian/cek_panggilan",data:{id:a},dataType:"json",success:function(a){1!=a.efek&&(e=!0)},complete:function(){e?($(".modal-title").text("Nomor Antrian "+nomor_dipanggil),$("#modal").modal({backdrop:"static",keyboard:!1}),0==berurut?ke():$(".loader2").hide()):setTimeout((()=>{cek_panggilan(a)}),3e3)}})}function cek_panggilan_pengumuman(a){let e=!1;$.ajax({type:"post",url:base_url+"antrian/cek_panggilan",data:{id:a},dataType:"json",success:function(a){1!=a.efek&&(e=!0)},complete:function(){e?$(".loader2").hide():setTimeout((()=>{cek_panggilan_pengumuman(a)}),3e3)}})}function ke(){let a=$("#ke");$.ajax({type:"get",url:base_url+"setting/data_layanan",dataType:"json",success:function(e){$("#ke").empty();for(let a=0;a<e.length;a++){let n=e[a];$("#ke").append("<option value="+n.layanan+">"+n.nama_layanan+"</option>")}switch(layanan){case"pengaduan":a.val("posbakum");break;case"pendaftaran":case"produk":a.val("kasir");break;case"ecourt":a.val("bank");break;case"kasir":case"posbakum":case"pos":a.val("pendaftaran");break;case"bank":a.val("ecourt")}},error:function(a){console.log(a.responseText)},complete:function(){$(".loader2").hide()}})}function arahkan(){let a=$("#ke").val(),e=$("#ke option:selected").text();$.ajax({type:"post",url:base_url+"antrian/ubah",data:{id:id_dipanggil,ke:a},dataType:"json",beforeSend:function(){$(".loader2").show()},success:function(a){1==a.success?($("#modal").modal("toggle"),dt_antrian.ajax.reload(),$("#respon").html("<div class='alert alert-success' role='alert' id='responMsg'><strong>Selamat</strong> Antrian berhasil diarahkan ke "+e+"</div>"),$("#responMsg").hide().fadeIn(200).delay(2e3).fadeOut(1e3,(function(){$(this).remove()}))):alert("maaf ada kesalahan, mohon coba kembali")},error:function(a){console.log(a.responseText)},complete:function(){$(".loader2").hide()}})}function tunda(){$.ajax({type:"post",url:base_url+"antrian/ubah",data:{id:id_dipanggil,ke:"tunda"},dataType:"json",beforeSend:function(){$(".loader2").show()},success:function(a){1==a.success?($("#modal").modal("toggle"),dt_antrian.ajax.reload(),$("#respon").html("<div class='alert alert-success' role='alert' id='responMsg'><strong>Selamat</strong> Antrian berhasil ditunda</div>"),$("#responMsg").hide().fadeIn(200).delay(2e3).fadeOut(1e3,(function(){$(this).remove()}))):alert("maaf ada kesalahan, mohon coba kembali")},error:function(a){console.log(a.responseText)},complete:function(){$(".loader2").hide()}})}function hapus(){$.ajax({type:"post",url:base_url+"antrian/hapus",data:{id:id_dipanggil},dataType:"text",success:function(a){1==a?($("#modal").modal("toggle"),dt_antrian.ajax.reload(),$("#respon").html("<div class='alert alert-success' role='alert' id='responMsg'><strong>Selamat</strong> Antrian berhasil dihapus</div>"),$("#responMsg").hide().fadeIn(200).delay(2e3).fadeOut(1e3,(function(){$(this).remove()}))):alert("maaf ada kesalahan, mohon coba kembali")},error:function(a){console.log(a.responseText)},complete:function(){$(".loader2").hide()}})}$(document).ready((function(){$("#sidebar_antrian").addClass("active"),dt_antrian=$("#dt_antrian").DataTable({dom:"Bfrtip",ordering:!1,searching:!1,ajax:{url:base_url+"antrian/antrian/"+layanan,dataSrc:""},columns:[{data:"id"},{data:null,sortable:!1,render:function(a,e,n,t){return berurut?kode+n.no:n.no}},{data:"status",sortable:!1},{data:null,sortable:!1,render:function(a,e,n,t){return"<a href='#' onclick='panggil("+n.id+","+n.no+")' class='btn btn-primary'><i class='fas fa-phone'></i> Panggil</a>"}}],columnDefs:[{targets:0,visible:!1},{targets:"_all",className:"text-center",orderable:!1}],responsive:!0,autoWidth:!1}),setInterval((()=>{dt_antrian.ajax.reload(null,!1)}),5e3),$("#btn_pengumuman").click((function(){$("#pengumumanModal").modal({backdrop:"static",keyboard:!1})})),$("#modal_pengumuman").click((function(){pengumuman=$("#text_pengumuman").val(),$.ajax({type:"post",url:base_url+"antrian/panggil",data:{no:0,layanan:"pengumuman",pengumuman:pengumuman},dataType:"json",beforeSend:function(){$(".loader2").show()},success:function(a){1==a.success?cek_panggilan_pengumuman(a.id):($(".loader2").hide(),alert("gagal memanggil, silahkan coba lagi"))},error:function(a){console.log(a.responseText),$(".loader2").hide(),alert("gagal memanggil, silahkan coba lagi")}})}))}));